<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Neue Hacknet-Website erstellen</title>
<style>
  body { font-family: Arial, sans-serif; margin: 20px; max-width: 600px; }
  label { display: block; margin-top: 15px; }
  input, textarea { width: 100%; padding: 8px; margin-top: 5px; box-sizing: border-box; }
  button { margin-top: 15px; padding: 10px 20px; }
  #result { margin-top: 20px; font-weight: bold; }
</style>
</head>
<body>
<h1>Neue Hacknet-Website erstellen</h1>

<label for="link">Name der Seite (z.B. meine-seite)</label>
<input type="text" id="link" placeholder="hacknet://meine-seite" />

<label for="owner">Dein Name (Owner)</label>
<input type="text" id="owner" placeholder="Dein Name" />

<label for="desc">Beschreibung (optional)</label>
<textarea id="desc" rows="2" placeholder="Kurze Beschreibung"></textarea>

<label for="code">HTML-Code der Seite</label>
<textarea id="code" rows="15" placeholder="Hier den HTML-Code deiner Seite eingeben..."></textarea>

<button onclick="upload()">Seite hochladen</button>

<div id="result"></div>

<script>
const FIREBASE_DB = "https://hacknet-sites-by-users-default-rtdb.firebaseio.com/";

async function upload() {
    const link = document.getElementById('link').value.trim();
    const owner = document.getElementById('owner').value.trim();
    const desc = document.getElementById('desc').value.trim();
    const code = document.getElementById('code').value.trim();

    if (!link || !code) {
        document.getElementById('result').innerText = "⚠️ Link und HTML-Code dürfen nicht leer sein.";
        return;
    }

    // Prüfen, ob Seite schon existiert:
    const checkRes = await fetch(`${FIREBASE_DB}sites/${link}.json`);
    const existing = await checkRes.json();
    if (existing !== null) {
        document.getElementById('result').innerText = "❌ Fehler: Name bereits verwendet!";
        return;
    }

    const data = {
        owner: owner,
        description: desc,
        html: code,
        approved: false,
        timestamp: Date.now()
    };

    const res = await fetch(`${FIREBASE_DB}sites/${link}.json`, {
        method: "PUT",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data)
    });

    if (res.ok) {
        document.getElementById('result').innerText = "✅ Erfolgreich hochgeladen! Warte auf Freischaltung.";
    } else {
        document.getElementById('result').innerText = "❌ Fehler beim Hochladen.";
    }
}
</script>

</body>
</html>
